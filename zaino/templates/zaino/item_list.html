
{% extends "base.html" %}

{% block content %}
<form method="post" id="gear-form">
    {% csrf_token %}
    
    {% if selected_items %}
    <div class="weight-display">
        <div class="weight-number">{{ total_weight|floatformat:1 }}</div>
        <div class="weight-label">kg total weight</div>
    </div>
    
    <div class="selected-items-list">
        <h3>📦 Selected Gear ({{ selected_items|length }} items)</h3>
        {% for item in selected_items %}
        <div class="selected-item">
            <span>{{ item.name }}</span>
            <span class="item-weight">{{ item.weight|floatformat:1 }}kg</span>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="weight-display">
        <div class="weight-number">0.0</div>
        <div class="weight-label">kg total weight</div>
    </div>
    {% endif %}
    
    {% if categories %}
        {% for category in categories %}
        <div class="category-section">
            <div class="category-header">
                {% if category.name == "Shelter" %}🏕️
                {% elif category.name == "Clothing" %}👕
                {% elif category.name == "Cooking" %}🍳
                {% elif category.name == "Safety" %}🚨
                {% elif category.name == "Navigation" %}🧭
                {% elif category.name == "Hydration" %}💧
                {% elif category.name == "Food" %}🍎
                {% else %}📦{% endif %}
                {{ category.name }}
                <small style="opacity: 0.8; font-weight: normal;">({{ category.items.all|length }} items)</small>
            </div>
            
            {% for item in category.items.all %}
            <div class="item {% if item in selected_items %}selected{% endif %}">
                <div class="item-checkbox">
                    <input type="checkbox" 
                           name="items" 
                           value="{{ item.id }}" 
                           id="item{{ item.id }}" 
                           {% if item in selected_items %}checked{% endif %}>
                    <div class="checkmark"></div>
                </div>
                
                <div class="item-info">
                    <div class="item-name">{{ item.name }}</div>
                    <div class="item-details">
                        <span class="item-weight">{{ item.weight|floatformat:1 }}kg</span>
                        {% if item.brand %}
                        <span class="item-brand">{{ item.brand.name }}</span>
                        {% endif %}
                    </div>
                    {% if item.description %}
                    <div class="item-description">{{ item.description }}</div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    {% else %}
    <div class="empty-state">
        <div class="icon">📦</div>
        <h3>No gear available</h3>
        <p>Add some items in the admin panel to get started!</p>
    </div>
    {% endif %}
</form>

<div class="bottom-bar">
    <button class="calculate-btn" type="submit" form="gear-form">
        🎒 Update Pack Weight
    </button>
</div>

<script>
// Auto-submit form when checkboxes change for real-time updates
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('gear-form');
    const checkboxes = document.querySelectorAll('input[name="items"]');
    
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            // Add visual feedback
            const item = this.closest('.item');
            if (this.checked) {
                item.style.transform = 'translateX(5px)';
            } else {
                item.style.transform = 'translateX(0)';
            }
            
            // Auto-submit after short delay for better UX
            setTimeout(() => {
                form.submit();
            }, 200);
        });
    });
});
</script>
{% endblock %}
